<!doctype html>
<html lang="en" style="height: 100%;">

<head>
  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, shrink-to-fit=no, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="manifest" href="./manifest.json">

  <title>runtime</title>

  <script src="./node_modules/construct-style-sheets-polyfill/dist/adoptedStyleSheets.js"></script>

  <script>
    let storedParentUrl;
    window.esmsInitOptions = {
      shimMode: true,
      mapOverrides: true,
      resolve: (id, parentUrl, resolve) => {
        if (!storedParentUrl)
          storedParentUrl = parentUrl;
        if (parentUrl.startsWith('blob:'))
          parentUrl = storedParentUrl;
        return resolve(id, parentUrl)
      }
    }
  </script>
  <script src="./node_modules/es-module-shims/dist/es-module-shims.js"></script>
  <script src="/webui.0.widgets/importmap.js"></script>
  <script src="./dist/importmaps/importmap-runtime.js"></script>

  <script src="config.js"></script>

  <script type="module">
    const scp = document.createElement('script');
    scp.src = iobrokerWebRootUrl + "webui.0.widgets/importmap.js";
    document.head.appendChild(scp);

    await importShim('./dist/frontend/runtime/init.js');
    importShim('./dist/frontend/runtime/controls.js');
    importShim(iobrokerWebRootUrl + 'webui.0.widgets/importWidgetFilesRuntime.js');
  </script>
</head>

<style>
  body {
    height: 100%;
    margin: 0;
    font-family: 'Roboto', 'Noto', sans-serif;
    line-height: 1.5;
    background-color: white;
    -webkit-font-smoothing: antialiased;
  }
</style>

<body>
  <iobroker-webui-screen-viewer id="viewer"></iobroker-webui-screen-viewer>
  <script type="module">
    async function checkHash() {
      const screen = (new URLSearchParams(location.hash.substring(1))).get('screenName');
      if (screen) {
        const viewer = document.getElementById('viewer');
        await customElements.whenDefined(viewer.localName);
        viewer.screenName = screen;
      } else {
        viewer.screenName = 'start';
      }
    }
    checkHash();
    window.onhashchange = checkHash;
  </script>
</body>

<body>

</html>